<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi-Cloud Orchestration - Terraform</title>
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body>
  <header>
    <nav>
      <h1>Tech Overview</h1>
      <ul>
        <li><a href="../index.html">Home</a></li>
        <li><a href="../index.html#technologies">Technologies</a></li>
      </ul>
    </nav>
  </header>

  <div class="breadcrumb">
    <a href="../index.html">Home</a> / <a href="terraform.html">Terraform</a> / <span>Multi-Cloud Orchestration</span>
  </div>

  <main>
    <a href="terraform.html" class="back-link">← Back to Terraform</a>

    <section class="use-case-detail">
      <h2>Multi-Cloud Orchestration with Terraform</h2>
      <p>Deploy and manage resources simultaneously across AWS, GCP, Azure with unified infrastructure code and cross-cloud networking.</p>

      <h3>Overview</h3>
      <p>Terraform's multi-cloud provider system enables deploying applications across multiple cloud platforms using a single configuration language. This provides cloud portability, cost optimization through cloud provider selection, and disaster recovery capabilities.</p>

      <h3>Multi-Provider Configuration</h3>
      <div class="code-label">HCL - main.tf with AWS, GCP, Azure</div>
      <pre><code class="language-hcl">terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
    google = {
      source  = "hashicorp/google"
      version = "~> 5.0"
    }
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 3.0"
    }
  }
}

provider "aws" {
  region = var.aws_region
}

provider "google" {
  project = var.gcp_project
  region  = var.gcp_region
}

provider "azurerm" {
  features {}
  subscription_id = var.azure_subscription_id
}

# Application hosted across clouds
locals {
  cloud_regions = {
    aws = {
      region        = var.aws_region
      instance_type = "t3.medium"
      count         = 2
    }
    gcp = {
      region       = var.gcp_region
      machine_type = "e2-standard-2"
      count        = 2
    }
    azure = {
      region = var.azure_region
      sku    = "Standard_B2s"
      count  = 1
    }
  }
}</code></pre>

      <h3>AWS Compute Resources</h3>
      <div class="code-label">HCL - aws-resources.tf</div>
      <pre><code class="language-hcl">resource "aws_vpc" "main" {
  cidr_block = "10.0.0.0/16"

  tags = {
    Name        = "multi-cloud-vpc"
    Environment = var.environment
    ManagedBy   = "terraform"
  }
}

resource "aws_subnet" "main" {
  vpc_id            = aws_vpc.main.id
  cidr_block        = "10.0.1.0/24"
  availability_zone = "${var.aws_region}a"
}

resource "aws_instance" "app" {
  count                       = local.cloud_regions.aws.count
  ami                         = data.aws_ami.ubuntu.id
  instance_type               = local.cloud_regions.aws.instance_type
  subnet_id                   = aws_subnet.main.id
  associate_public_ip_address = true

  user_data = base64encode(templatefile("${path.module}/user-data.sh", {
    environment = var.environment
    cloud       = "aws"
  }))

  tags = {
    Name  = "app-server-aws-${count.index}"
    Cloud = "aws"
  }
}

resource "aws_load_balancer" "main" {
  name            = "multi-cloud-alb"
  load_balancer_type = "application"
  subnets         = [aws_subnet.main.id]

  tags = {
    Name = "app-load-balancer"
  }
}

data "aws_ami" "ubuntu" {
  most_recent = true
  owners      = ["099720109477"]

  filter {
    name   = "name"
    values = ["ubuntu/images/hvm-ssd/ubuntu-jammy-22.04-amd64-server-*"]
  }
}</code></pre>

      <h3>GCP Compute Resources</h3>
      <div class="code-label">HCL - gcp-resources.tf</div>
      <pre><code class="language-hcl">resource "google_compute_network" "main" {
  name                    = "multi-cloud-network"
  auto_create_subnetworks = false
}

resource "google_compute_subnetwork" "main" {
  name          = "multi-cloud-subnet"
  ip_cidr_range = "10.1.0.0/24"
  region        = local.cloud_regions.gcp.region
  network       = google_compute_network.main.id
}

resource "google_compute_instance" "app" {
  count        = local.cloud_regions.gcp.count
  name         = "app-server-gcp-${count.index}"
  machine_type = local.cloud_regions.gcp.machine_type
  zone         = "${local.cloud_regions.gcp.region}-a"

  boot_disk {
    initialize_params {
      image = "ubuntu-os-cloud/ubuntu-2204-lts"
      size  = 30
    }
  }

  network_interface {
    network    = google_compute_network.main.name
    subnetwork = google_compute_subnetwork.main.name
  }

  metadata_startup_script = file("${path.module}/user-data.sh")

  labels = {
    cloud       = "gcp"
    environment = var.environment
  }
}

resource "google_compute_backend_service" "main" {
  name      = "app-backend-service"
  protocol  = "HTTP"
  port_name = "http"

  health_checks = [google_compute_health_check.main.id]
}

resource "google_compute_health_check" "main" {
  name = "app-health-check"

  http_health_check {
    port = 8080
  }
}</code></pre>

      <h3>Azure Compute Resources</h3>
      <div class="code-label">HCL - azure-resources.tf</div>
      <pre><code class="language-hcl">resource "azurerm_resource_group" "main" {
  name     = "multi-cloud-rg"
  location = local.cloud_regions.azure.region
}

resource "azurerm_virtual_network" "main" {
  name                = "multi-cloud-vnet"
  address_space       = ["10.2.0.0/16"]
  location            = azurerm_resource_group.main.location
  resource_group_name = azurerm_resource_group.main.name
}

resource "azurerm_subnet" "main" {
  name                 = "multi-cloud-subnet"
  resource_group_name  = azurerm_resource_group.main.name
  virtual_network_name = azurerm_virtual_network.main.name
  address_prefixes     = ["10.2.1.0/24"]
}

resource "azurerm_network_interface" "main" {
  count               = local.cloud_regions.azure.count
  name                = "nic-${count.index}"
  location            = azurerm_resource_group.main.location
  resource_group_name = azurerm_resource_group.main.name

  ip_configuration {
    name                          = "testConfiguration"
    subnet_id                     = azurerm_subnet.main.id
    private_ip_address_allocation = "Dynamic"
    public_ip_address_id          = azurerm_public_ip.main[count.index].id
  }
}

resource "azurerm_virtual_machine" "main" {
  count               = local.cloud_regions.azure.count
  name                = "app-server-azure-${count.index}"
  location            = azurerm_resource_group.main.location
  resource_group_name = azurerm_resource_group.main.name
  vm_size             = local.cloud_regions.azure.sku

  network_interface_ids = [azurerm_network_interface.main[count.index].id]

  os_profile {
    computer_name  = "app-${count.index}"
    admin_username = "azureuser"
  }

  os_profile_linux_config {
    disable_password_authentication = true
    ssh_keys {
      path     = "/home/azureuser/.ssh/authorized_keys"
      key_data = file("~/.ssh/id_rsa.pub")
    }
  }

  storage_os_disk {
    name              = "disk-${count.index}"
    caching           = "ReadWrite"
    create_option     = "FromImage"
    managed_disk_type = "Premium_LRS"
  }
}</code></pre>

      <h3>Cross-Cloud Networking with VPC Peering</h3>
      <div class="code-label">HCL - network-peering.tf</div>
      <pre><code class="language-hcl"># VPC Peering between GCP and AWS (via interconnect)
resource "google_compute_network_peering" "gcp_aws" {
  name         = "gcp-aws-peering"
  network      = google_compute_network.main.self_link
  peer_network = aws_vpc.main.arn

  depends_on = [
    google_compute_network.main,
    aws_vpc.main
  ]
}

# Firewall rules for multi-cloud traffic
resource "google_compute_firewall" "multi_cloud" {
  name    = "allow-multi-cloud"
  network = google_compute_network.main.name

  allow {
    protocol = "tcp"
    ports    = ["80", "443", "3306", "5432"]
  }

  source_ranges = [
    aws_vpc.main.cidr_block,
    azurerm_virtual_network.main.address_space[0]
  ]
}

# AWS Security Group for cross-cloud access
resource "aws_security_group" "multi_cloud" {
  name   = "multi-cloud-sg"
  vpc_id = aws_vpc.main.id

  ingress {
    from_port   = 0
    to_port     = 65535
    protocol    = "tcp"
    cidr_blocks = [
      google_compute_network.main.routing_config[0].bgp_asn,
      azurerm_virtual_network.main.address_space[0]
    ]
  }
}

# Azure Network Security Group
resource "azurerm_network_security_group" "multi_cloud" {
  name                = "multi-cloud-nsg"
  location            = azurerm_resource_group.main.location
  resource_group_name = azurerm_resource_group.main.name

  security_rule {
    name                       = "allow-multi-cloud"
    priority                   = 100
    direction                  = "Inbound"
    access                     = "Allow"
    protocol                   = "Tcp"
    source_port_range          = "*"
    destination_port_range     = "*"
    source_address_prefixes    = [
      aws_vpc.main.cidr_block,
      "10.1.0.0/16"
    ]
    destination_address_prefix = "*"
  }
}</code></pre>

      <h3>Unified Load Balancing</h3>
      <div class="code-label">HCL - load-balancing.tf</div>
      <pre><code class="language-hcl">resource "google_compute_global_forwarding_rule" "multi_cloud" {
  name       = "app-global-forwarding-rule"
  ip_version = "IPV4"
  port_range = "80,443"
  target     = google_compute_target_https_proxy.main.self_link
}

resource "google_compute_backend_service" "multi_cloud" {
  name            = "app-multi-cloud-backend"
  protocol        = "HTTP"
  session_affinity = "NONE"
  timeout_sec     = 30

  # GCP backends
  backend {
    group = google_compute_instance_group_manager.main.instance_group
  }

  health_checks = [google_compute_health_check.main.id]
}

# Global load balancing config
resource "aws_route53_zone" "main" {
  name = "app.example.com"
}

resource "aws_route53_record" "multi_cloud" {
  zone_id = aws_route53_zone.main.zone_id
  name    = "app.example.com"
  type    = "A"

  set_identifier = "multi-cloud"

  failover_routing_policy {
    type = "PRIMARY"
  }

  alias {
    name                   = aws_load_balancer.main.dns_name
    zone_id                = aws_load_balancer.main.zone_id
    evaluate_target_health = true
  }
}</code></pre>

      <h3>Outputs and Service Discovery</h3>
      <div class="code-label">HCL - outputs.tf</div>
      <pre><code class="language-hcl">output "multi_cloud_endpoints" {
  value = {
    aws_load_balancer_dns = aws_load_balancer.main.dns_name
    gcp_load_balancer_ip  = google_compute_global_address.main.address
    azure_app_gateway_fqdn = azurerm_application_gateway.main.fqdn
  }
  description = "Endpoints for multi-cloud application"
}

output "aws_instances" {
  value = {
    for instance in aws_instance.app :
    instance.id => instance.public_ip
  }
}

output "gcp_instances" {
  value = {
    for instance in google_compute_instance.app :
    instance.name => instance.network_interface[0].access_config[0].nat_ip
  }
}

output "azure_instances" {
  value = {
    for idx, public_ip in azurerm_public_ip.main :
    idx => public_ip.ip_address
  }
}</code></pre>

      <h3>Best Practices</h3>
      <ul>
        <li>Use provider aliases to manage multiple regions or accounts</li>
        <li>Abstract cloud-specific resources using modules</li>
        <li>Implement consistent naming conventions across clouds</li>
        <li>Use workspace outputs for service discovery</li>
        <li>Configure cross-cloud networking securely with VPN/Interconnect</li>
        <li>Implement cloud-agnostic DNS for global load balancing</li>
        <li>Use condition logic to control cloud-specific deployments</li>
        <li>Establish comprehensive monitoring across all clouds</li>
        <li>Test failover scenarios between cloud providers</li>
        <li>Maintain separate state files per cloud for isolation</li>
      </ul>
    </section>
  </main>

  <footer class="footer">
    <p>Technology Overview • January 2026</p>
  </footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-kotlin.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
</body>
</html>
