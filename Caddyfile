(common-config) {
    log {
        output stdout
    }

    handle_path /one* {
        root * /var/www/one-frontend
        file_server
    }

    handle_path /another* {
        root * /var/www/another-frontend
        file_server
    }

    handle_path /my-deno* {
        reverse_proxy deno-app:8000
    }

    handle /process-data* {
        reverse_proxy python-app:8000
    }
}

{
    order rate_limit before reverse_proxy
}

http://localhost {
    import common-config
}

demos.pnetto.com {
    route {
        # Matcher for static assets
        @static path *.html *.css *.js *.png *.jpg *.jpeg *.gif *.svg *.webp

        # Apply rate limit only if it's not a static asset
        @notStatic not @static
        
        rate_limit @notStatic {
            zone dynamic_zone {
                key {remote_host}
                window 10s
                events 5
            }
        }
    }
    
    import common-config
}